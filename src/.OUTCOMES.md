  ---                                                                                                                                                                                                                               
OutcomeType Flow Documentation (Streamlined Mode)

Phase: SET_ENCOUNTERS

getOutcomeTypes: Not applicable - no outcomeTypes used                                                                                                                                                                            
Handler: addAllSubmissionsToAdventureMap                                                                                                                                                                                          
OutcomeType Mapping: N/A - submissions become EncounterLabel objects directly
- submission.getCurrentText() → EncounterLabel.encounterLabel
- Auto-generated UUID → EncounterLabel.encounterId

  ---                                                                                                                                                                                                                               
Phase: WHAT_HAPPENS_HERE

getOutcomeTypes (Round 1):
- Returns all EncounterLabel objects from AdventureMap
- OutcomeType.id = EncounterLabel.encounterId
- OutcomeType.label = EncounterLabel.encounterLabel

getOutcomeTypes (Round > 1):
- Returns filtered EncounterLabels (excluding already-used ones)
- OutcomeType.clarifier = assigned Story.storyId (for branching)

Handler: handleWhatHappensHereStreamlined                                                                                                                                                                                         
OutcomeType Mapping:                                                                                                                                                                                                              
┌────────────────────────────────┬───────────────────────────────────────────────┐                                                                                                                                                
│   OutcomeTypeWithLabel Field   │                    Maps To                    │                                                                                                                                                
├────────────────────────────────┼───────────────────────────────────────────────┤                                                                                                                                                
│ outcomeType (id)               │ Story.encounterLabel (matched by encounterId) │                                                                                                                                                
├────────────────────────────────┼───────────────────────────────────────────────┤                                                                                                                                                
│ outcomeTypeWithLabel.clarifier │ Story.prequelStoryId                          │                                                                                                                                                
├────────────────────────────────┼───────────────────────────────────────────────┤                                                                                                                                                
│ submission.getCurrentText()    │ Story.prompt                                  │                                                                                                                                                
├────────────────────────────────┼───────────────────────────────────────────────┤                                                                                                                                                
│ submission.getCurrentText()    │ Encounter.storyPrompt                         │                                                                                                                                                
└────────────────────────────────┴───────────────────────────────────────────────┘
  ---                                                                                                                                                                                                                               
Phase: WHAT_CAN_WE_TRY

getOutcomeTypes:
- Returns unvisited Story objects distributed to players
- OutcomeType.id = Story.storyId
- OutcomeType.label = Story.prompt

Handler: handleWhatCanWeTry                                                                                                                                                                                                       
OutcomeType Mapping:                                                                                                                                                                                                              
┌─────────────────────────────┬──────────────────────────────────────┐                                                                                                                                                            
│ OutcomeTypeWithLabel Field  │               Maps To                │                                                                                                                                                            
├─────────────────────────────┼──────────────────────────────────────┤                                                                                                                                                            
│ outcomeType (id)            │ Used to match Story (but not stored) │                                                                                                                                                            
├─────────────────────────────┼──────────────────────────────────────┤                                                                                                                                                            
│ submission.getCurrentText() │ Story.options[].optionText           │                                                                                                                                                            
└─────────────────────────────┴──────────────────────────────────────┘
  ---                                                                                                                                                                                                                               
Phase: HOW_DOES_THIS_RESOLVE / HOW_DOES_THIS_RESOLVE_AGAIN

getOutcomeTypes:
- Returns single OutcomeType per player with subTypes array
- OutcomeType.id = Story.storyId (parent)
- OutcomeType.label = Story.prompt
- OutcomeType.clarifier = from distributed story (if set)
- OutcomeType.subTypes[] = WHAT_CAN_WE_TRY submissions related to story:
    - subType.id = TextSubmission.submissionId
    - subType.label = TextSubmission.currentText (the option text)

Handler: handleHowDoesThisResolve                                                                                                                                                                                                 
OutcomeType Mapping:                                                                                                                                                                                                              
┌───────────────────────────────────────┬─────────────────────────────┐                                                                                                                                                           
│      OutcomeTypeWithLabel Field       │           Maps To           │                                                                                                                                                           
├───────────────────────────────────────┼─────────────────────────────┤                                                                                                                                                           
│ outcomeTypeWithLabel.id               │ Matches Story.storyId       │                                                                                                                                                           
├───────────────────────────────────────┼─────────────────────────────┤                                                                                                                                                           
│ outcomeTypeWithLabel.subTypes[].id    │ Story.options[].optionId    │                                                                                                                                                           
├───────────────────────────────────────┼─────────────────────────────┤                                                                                                                                                           
│ outcomeTypeWithLabel.subTypes[].label │ Story.options[].optionText  │                                                                                                                                                           
├───────────────────────────────────────┼─────────────────────────────┤                                                                                                                                                           
│ submission.getCurrentText()           │ Story.options[].successText │                                                                                                                                                           
└───────────────────────────────────────┴─────────────────────────────┘                                                                                                                                                           
The handler also removes the matched WHAT_CAN_WE_TRY submission and initializes MAKE_CHOICE_VOTING.
                                                                                                                                                                                                                                    
---                                                                                                                                                                                                                               
Phase: MAKE_CHOICE_VOTING

getOutcomeTypes:
- Returns assigned Story if player is at its encounter
- OutcomeType.id = Story.storyId
- OutcomeType.label = Story.prompt

Handler: handleMakeChoice                                                                                                                                                                                                         
OutcomeType Mapping:                                                                                                                                                                                                              
┌────────────────────────────┬────────────────────────┐                                                                                                                                                                           
│ OutcomeTypeWithLabel Field │        Maps To         │                                                                                                                                                                           
├────────────────────────────┼────────────────────────┤                                                                                                                                                                           
│ submission.submissionId    │ Story.selectedOptionId │                                                                                                                                                                           
├────────────────────────────┼────────────────────────┤                                                                                                                                                                           
│ N/A                        │ Story.visited = true   │                                                                                                                                                                           
└────────────────────────────┴────────────────────────┘                                                                                                                                                                           
The submissionId in MAKE_CHOICE_VOTING phase equals the optionId that was voted for.
                                                                                                                                                                                                                                    
---                                                                                                                                                                                                                               
Summary Table                                                                                                                                                                                                                     
┌───────────────────────┬────────────────────────────┬───────────────────────────────┬─────────────────────────┬────────────────────────────┐                                                                                     
│         Phase         │       OutcomeType.id       │       OutcomeType.label       │  OutcomeType.clarifier  │    OutcomeType.subTypes    │                                                                                     
├───────────────────────┼────────────────────────────┼───────────────────────────────┼─────────────────────────┼────────────────────────────┤                                                                                     
│ SET_ENCOUNTERS        │ N/A                        │ N/A                           │ N/A                     │ N/A                        │                                                                                     
├───────────────────────┼────────────────────────────┼───────────────────────────────┼─────────────────────────┼────────────────────────────┤                                                                                     
│ WHAT_HAPPENS_HERE     │ EncounterLabel.encounterId │ EncounterLabel.encounterLabel │ Story.storyId (round>1) │ N/A                        │                                                                                     
├───────────────────────┼────────────────────────────┼───────────────────────────────┼─────────────────────────┼────────────────────────────┤                                                                                     
│ WHAT_CAN_WE_TRY       │ Story.storyId              │ Story.prompt                  │ N/A                     │ N/A                        │                                                                                     
├───────────────────────┼────────────────────────────┼───────────────────────────────┼─────────────────────────┼────────────────────────────┤                                                                                     
│ HOW_DOES_THIS_RESOLVE │ Story.storyId              │ Story.prompt                  │ Story clarifier         │ TextSubmission[] (options) │                                                                                     
├───────────────────────┼────────────────────────────┼───────────────────────────────┼─────────────────────────┼────────────────────────────┤                                                                                     
│ MAKE_CHOICE_VOTING    │ Story.storyId              │ Story.prompt                  │ N/A                     │ N/A                        │                                                                                     
└───────────────────────┴────────────────────────────┴───────────────────────────────┴─────────────────────────┴────────────────────────────┘                                                                                     
